%%%% This code is written by Aref Ghaderi, ghaderi1@msu.edu
%%%% arefghaderi1372@gmail.com 

clc; clear;
%%%%% Initial Weights %%%%
x0 = [.4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4 .4]/80;

%%%%% Constraint to gurantee thermodynamic consistency %%%%%
lb = [0, -1000, 0, 0, -1000, 0, 0, -1000, 0, 0, -1000, 0, 0, -1000, 0, 0, -1000, 0, 0, -1000, 0, 0, -1000, 0, -1000, -1000, -1000 -1000, -1000, -1000, -1000 -1000];
ub = [1000, 1000, 1000, 1000, 1000, 1000,1000, 1000, 1000,1000, 1000, 1000,1000, 1000, 1000,1000, 1000, 1000,1000, 1000, 1000,1000, 1000, 1000,1000, 1000, 1000 1000,1000, 1000, 1000 1000];

%%%%% Optimizer %%%%%
fun = @(x)func_training([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16) x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]);
A = [];
b = [];
Aeq = [];
beq = [];
nonlcon = [];
options = optimoptions('fmincon','Display','iter','Algorithm','sqp');
[x,fval,exitflag,output] = fmincon(fun,x0,A,b,Aeq,beq,lb,ub,nonlcon,options);

%%% Experimental Data Uniaxial for Relaxation test at 60 C for 20% and 50%
%%% strain %%%%%%%%%%%%%%%

time_60_20 = [3,3.07500000000000,3.13000000000000,3.18000000000000,3.25000000000000,3.31900000000000,3.38900000000000,3.48400000000000,3.55900000000000,3.59900000000000,3.68300000000000,3.73300000000000,3.81300000000000,3.90700000000000,3.99700000000000,4.10200000000000,4.21100000000000,4.28600000000000,4.38100000000000,4.47500000000000,4.56000000000000,4.65000000000000,4.76000000000000,4.85900000000000,4.95400000000000,5.03400000000000,5.11300000000000,5.17800000000000,5.27300000000000,5.34300000000000,5.42700000000000,5.50700000000000,5.59200000000000,5.65600000000000,5.72600000000000,5.80100000000000,5.87000000000000,5.93500000000000,6.03500000000000,6.08900000000000,6.14900000000000,6.21400000000000,6.27400000000000,6.30800000000000,6.35800000000000,6.38800000000000];
stress_60_20 = [2.00300000000000,1.99100000000000,1.97100000000000,1.96200000000000,1.95000000000000,1.92900000000000,1.92500000000000,1.90500000000000,1.89200000000000,1.89700000000000,1.87200000000000,1.86400000000000,1.85500000000000,1.84300000000000,1.83500000000000,1.82300000000000,1.81400000000000,1.81400000000000,1.80200000000000,1.78600000000000,1.77700000000000,1.78200000000000,1.76900000000000,1.76500000000000,1.74900000000000,1.73600000000000,1.72800000000000,1.72000000000000,1.71200000000000,1.70300000000000,1.67900000000000,1.67900000000000,1.65800000000000,1.63400000000000,1.62100000000000,1.60100000000000,1.58400000000000,1.56000000000000,1.53100000000000,1.50600000000000,1.48200000000000,1.46500000000000,1.43600000000000,1.42000000000000,1.39900000000000,1.37100000000000];

time_60_50 = [3,3.04100000000000,3.13800000000000,3.27100000000000,3.40400000000000,3.54800000000000,3.65000000000000,3.74700000000000,3.86500000000000,3.95200000000000,4.07400000000000,4.18700000000000,4.31500000000000,4.40700000000000,4.52000000000000,4.63700000000000,4.74000000000000,4.91400000000000,4.99500000000000,5.09800000000000,5.20500000000000,5.29700000000000,5.38900000000000,5.48700000000000,5.58900000000000,5.66600000000000,5.75200000000000,5.83900000000000,5.94700000000000,6.03400000000000,6.10500000000000,6.17100000000000,6.24800000000000,6.31500000000000];
stress_60_50 = [3.38900000000000,3.38900000000000,3.34800000000000,3.29400000000000,3.25900000000000,3.20600000000000,3.18200000000000,3.13500000000000,3.09900000000000,3.09900000000000,3.04600000000000,3.00500000000000,3.00500000000000,2.98100000000000,2.95100000000000,2.92200000000000,2.90400000000000,2.86800000000000,2.85100000000000,2.82700000000000,2.79700000000000,2.78500000000000,2.74400000000000,2.72000000000000,2.68500000000000,2.64400000000000,2.60200000000000,2.56100000000000,2.52000000000000,2.46600000000000,2.42500000000000,2.35400000000000,2.32500000000000,2.27200000000000];


%%% Experimental Data Uniaxial for Relaxation test at 80 C for 20% and 50%
%%% strain %%%%%%%%%%%%%%%

time_80_20 = [3,3.03000000000000,3.07500000000000,3.12500000000000,3.16500000000000,3.22000000000000,3.25900000000000,3.33400000000000,3.37400000000000,3.42900000000000,3.49300000000000,3.53800000000000,3.59800000000000,3.65800000000000,3.74700000000000,3.82200000000000,3.88700000000000,3.95200000000000,4.04600000000000,4.11600000000000,4.19600000000000,4.28000000000000,4.37500000000000,4.45000000000000,4.52400000000000,4.59900000000000,4.68900000000000,4.78800000000000,4.85800000000000,4.92300000000000,5.01200000000000,5.07700000000000,5.13700000000000,5.20200000000000,5.26100000000000,5.32600000000000,5.40600000000000,5.47000000000000,5.53000000000000,5.60400000000000,5.65400000000000,5.71900000000000,5.75800000000000,5.81300000000000,5.84800000000000,5.88700000000000,5.92200000000000,5.95600000000000,5.98600000000000,6.01600000000000,6.04500000000000,6.06500000000000,6.10000000000000,6.15900000000000];
stress_80_20 = [1.95800000000000,1.94200000000000,1.93400000000000,1.91700000000000,1.90500000000000,1.88800000000000,1.85500000000000,1.84700000000000,1.82300000000000,1.81400000000000,1.79800000000000,1.79000000000000,1.76900000000000,1.75700000000000,1.74000000000000,1.73200000000000,1.69900000000000,1.70300000000000,1.67900000000000,1.67100000000000,1.65400000000000,1.64200000000000,1.62500000000000,1.61300000000000,1.60100000000000,1.59300000000000,1.57600000000000,1.55100000000000,1.53500000000000,1.51000000000000,1.48600000000000,1.46900000000000,1.44100000000000,1.42400000000000,1.38700000000000,1.37100000000000,1.33000000000000,1.29300000000000,1.25600000000000,1.19800000000000,1.15700000000000,1.12000000000000,1.07900000000000,1.03800000000000,0.985000000000000,0.927000000000000,0.882000000000000,0.828000000000000,0.775000000000000,0.734000000000000,0.672000000000000,0.619000000000000,0.557000000000000,0.426000000000000];

time_80_50 = [3,3.05100000000000,3.13300000000000,3.20900000000000,3.27600000000000,3.37800000000000,3.49600000000000,3.59300000000000,3.65900000000000,3.76700000000000,3.85900000000000,3.94600000000000,4.03800000000000,4.15000000000000,4.28300000000000,4.41600000000000,4.51800000000000,4.69200000000000,4.78400000000000,4.92700000000000,5.07000000000000,5.19800000000000,5.30000000000000,5.40700000000000,5.52900000000000,5.60600000000000,5.67200000000000,5.74300000000000,5.81500000000000,5.88600000000000,5.93600000000000,6.00200000000000,6.04300000000000,6.07300000000000,6.10300000000000,6.16900000000000];
stress_80_50 = [3.20000000000000,3.18800000000000,3.13500000000000,3.08800000000000,3.06400000000000,3.01100000000000,2.95800000000000,2.91700000000000,2.91100000000000,2.86300000000000,2.82200000000000,2.79300000000000,2.76300000000000,2.71600000000000,2.68000000000000,2.59800000000000,2.55000000000000,2.46800000000000,2.42600000000000,2.34900000000000,2.24900000000000,2.15500000000000,2.07200000000000,1.96600000000000,1.84800000000000,1.74100000000000,1.64100000000000,1.52900000000000,1.37600000000000,1.22200000000000,1.02800000000000,0.827000000000000,0.727000000000000,0.626000000000000,0.508000000000000,0.355000000000000];


%%% Experimental Data Uniaxial for Relaxation test at 100 C for 20% and 50%
%%% strain %%%%%%%%%%%%%%%

time_100_20 = [3,3.03500000000000,3.09900000000000,3.14900000000000,3.21900000000000,3.30300000000000,3.39300000000000,3.46300000000000,3.52700000000000,3.57700000000000,3.63200000000000,3.70600000000000,3.77600000000000,3.83600000000000,3.88000000000000,3.92000000000000,3.96000000000000,4.01500000000000,4.07500000000000,4.12400000000000,4.16400000000000,4.22400000000000,4.28900000000000,4.33800000000000,4.38300000000000,4.42800000000000,4.47300000000000,4.52200000000000,4.57200000000000,4.61700000000000,4.68100000000000,4.71600000000000,4.75100000000000,4.80100000000000,4.84000000000000,4.87000000000000,4.91500000000000,4.95900000000000,4.98900000000000,5.03400000000000,5.07300000000000,5.11300000000000,5.18300000000000,5.22700000000000,5.30200000000000,5.35100000000000,5.43100000000000,5.49000000000000,5.56500000000000,5.64000000000000,5.73400000000000,5.78900000000000,5.84900000000000];
stress_100_20 = [1.81000000000000,1.79400000000000,1.76900000000000,1.75300000000000,1.72400000000000,1.68700000000000,1.64600000000000,1.61700000000000,1.59300000000000,1.56000000000000,1.53900000000000,1.51400000000000,1.49000000000000,1.46500000000000,1.44500000000000,1.42800000000000,1.42400000000000,1.40400000000000,1.37500000000000,1.35800000000000,1.33800000000000,1.32100000000000,1.29300000000000,1.27200000000000,1.25200000000000,1.22700000000000,1.19400000000000,1.16500000000000,1.13700000000000,1.11200000000000,1.07500000000000,1.04600000000000,1.02600000000000,0.993000000000000,0.960000000000000,0.943000000000000,0.911000000000000,0.865000000000000,0.812000000000000,0.763000000000000,0.717000000000000,0.680000000000000,0.611000000000000,0.553000000000000,0.487000000000000,0.434000000000000,0.385000000000000,0.323000000000000,0.290000000000000,0.270000000000000,0.245000000000000,0.229000000000000,0.237000000000000];

time_100_50 = [3,3.05500000000000,3.12200000000000,3.18300000000000,3.27000000000000,3.38800000000000,3.46900000000000,3.53100000000000,3.59700000000000,3.69900000000000,3.75000000000000,3.84700000000000,3.92900000000000,4,4.10700000000000,4.19400000000000,4.29600000000000,4.37300000000000,4.49000000000000,4.54600000000000,4.62800000000000,4.67900000000000,4.73500000000000,4.78100000000000,4.84200000000000,4.90800000000000,4.97400000000000,5.03000000000000,5.06600000000000,5.10600000000000,5.15700000000000,5.20300000000000,5.23900000000000,5.30500000000000,5.36100000000000,5.39600000000000,5.46300000000000,5.54400000000000,5.60600000000000,5.71800000000000,5.80500000000000,5.90800000000000,5.96400000000000];
stress_100_50 = [3.10600000000000,3.05900000000000,3.02900000000000,3,2.93500000000000,2.87000000000000,2.82800000000000,2.80500000000000,2.71600000000000,2.65700000000000,2.60400000000000,2.54500000000000,2.47400000000000,2.38600000000000,2.27300000000000,2.20800000000000,2.10800000000000,2.00800000000000,1.88400000000000,1.81900000000000,1.73600000000000,1.68300000000000,1.59500000000000,1.51200000000000,1.43500000000000,1.32300000000000,1.25200000000000,1.13400000000000,1.05200000000000,0.999000000000000,0.893000000000000,0.781000000000000,0.704000000000000,0.592000000000000,0.521000000000000,0.485000000000000,0.426000000000000,0.350000000000000,0.314000000000000,0.273000000000000,0.232000000000000,0.208000000000000,0.208000000000000];

%%% Experimental Data Uniaxial for Intermittent test at 100 C for 12 hours %%%%%%%%%%%%%%%
stretch_100_12 = [1,1.01200000000000,1.03600000000000,1.05500000000000,1.07200000000000,1.09400000000000,1.11200000000000,1.13000000000000,1.14900000000000,1.18600000000000,1.20400000000000,1.22200000000000,1.24100000000000,1.27500000000000,1.30200000000000,1.33300000000000,1.37100000000000,1.40300000000000];
stress_100_12 = [0,0.743000000000000,1.38500000000000,1.73800000000000,2.13100000000000,2.40600000000000,2.78600000000000,3.02200000000000,3.31000000000000,3.79400000000000,4.03000000000000,4.26500000000000,4.51400000000000,4.84100000000000,5.15500000000000,5.48200000000000,5.90100000000000,6.29400000000000];

%%%% Predicted stress for relaxation and intermittent tests %%%%
[z] = funcSD_unaged([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16)  x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]); %%% Uniaxial prediction%%%%

[z60_50] = funcSD_60_50([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16)  x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]); %%% Uniaxial prediction%%%%

[z80_50] = funcSD_80_50([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16)  x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]); %%% Uniaxial prediction%%%%

[z100_50] = funcSD_100_50([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16)  x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]); %%% Uniaxial prediction%%%%

[z60_20] = funcSD_60_20([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16)  x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]); %%% Uniaxial prediction%%%%

[z80_20] = funcSD_80_20([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16)  x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]); %%% Uniaxial prediction%%%%

[z100_20] = funcSD_100_20([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16)  x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]); %%% Uniaxial prediction%%%%


figure(1)
hold on
plot(time_60_20, stress_60_20/max(stress_60_20), 'o');
plot(time_80_20, stress_80_20/max(stress_80_20), 'o');
plot(time_100_20, stress_100_20/max(stress_100_20), 'o');

plot(time_100_20, z100_20/max(z100_20));
plot(time_80_20, z80_20/max(z80_20));
plot(time_60_20, z60_20/max(z60_20),"--");


title('relaxation at strain = 20%')

figure(2)
hold on
plot(time_60_50, stress_60_50/max(stress_60_50), 'o');
plot(time_80_50, stress_80_50/max(stress_80_50), 'o');
plot(time_100_50, stress_100_50/max(stress_100_50), 'o');

plot(time_100_50,z100_50/max(z100_50), "--")
plot(time_80_50,z80_50/max(z80_50))
plot(time_60_50,z60_50/max(z60_50))


title('relaxation at strain = 50%')


figure(3)
hold on

plot(stretch_100_12, stress_100_12/max(stress_100_12), 'o');
plot(stretch_100_12,z/max(z),"--")


title('Theta = 100 and Time = 12h')


